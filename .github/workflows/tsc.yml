name: TypeScript build

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '18'

            - name: Install dependencies (if package.json exists)
              run: |
                  if [ -f package.json ]; then
                    npm ci || npm install
                  else
                    echo "no package.json, installing typescript globally"
                    npm install -g typescript
                  fi

            - name: Run TypeScript compiler
              run: |
                  # Prefer local tsc if available
                  if [ -f node_modules/.bin/tsc ]; then
                    npx tsc -p tsconfig.json
                  else
                    tsc -p tsconfig.json
                  fi

            - name: List emitted files (short)
              run: |
                  if [ -f tsconfig.json ]; then
                    node -e "console.log(require('fs').readdirSync('./assets/scripts').slice(0,20))" || true
                  fi
